<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="BoardDao">

	<resultMap type="BoardVO" id="boardMap">
	
		<id column="AR_ID" property="articleId" />
		<result column="SBJ" property="subject" />
		<result column="CONT" property="content" />
		<result column="CRT_DT" property="createdDate" />
		<result column="MDFY_DT" property="modifiedDate" />
		<result column="RD_CNT" property="readCount" />
		
		<association property="userVO" javaType="UserVO">
			<id column="USR_NO" property="userNo" />
			<id column="USR_ID" property="userId" />
			<id column="USR_NM" property="userName" />
		</association>
		
		
	</resultMap>


	<select id="getAllArticles" parameterType="BoardSearchVO" resultMap="boardMap">
		
		<include refid="CommonDao.PAGING_HEADER" />
			SELECT	@ROWNUM :=@ROWNUM + 1 AS ROWNUM
					, D.*
			FROM	(
									SELECT	
											 B.AR_ID
											, B.SBJ
											, B.CONT
											, B.USR_NO
											, U.USR_NM
											, DATE_FORMAT(B.CRT_DT, '%Y-%m-%d') CRT_DT
											, B.MDFY_DT
											, B.RD_CNT
									FROM	BOARD B
											, USRS U
										
									WHERE	B.USR_NO = U.USR_NO		
									ORDER	BY	CRT_DT DESC
										
									LIMIT 18446744073709551615

						) AS D
						, (SELECT @ROWNUM := 0) R	
			ORDER BY AR_ID DESC	
		<include refid="CommonDao.PAGING_FOOTER" />
	</select>
	
	<select id="getOneArticle" parameterType="string" resultMap="boardMap">
		SELECT	B.AR_ID
				, B.SBJ
				, B.CONT
				, B.USR_NO
				, U.USR_NM
				, DATE_FORMAT(B.CRT_DT, '%Y-%m-%d') CRT_DT
				, B.MDFY_DT
				, B.RD_CNT
		FROM	BOARD B
				, USRS U
		WHERE	B.AR_ID = #{articleId}
		AND		B.USR_NO = U.USR_NO
	</select>
	
	
	<select id="getAllArticlesCount" parameterType="BoardSearchVO" resultType="_int">
		SELECT	COUNT(1)
		FROM	BOARD 	
	</select>
	
	<insert id="insertOneArticle" parameterType="BoardVO">
			/*[BoardDao][insertOneArticle]*/
			INSERT	INTO	BOARD	(
									SBJ
									, CONT
									, USR_NO
									, CRT_DT
									, MDFY_DT
									, RD_CNT
								)
			VALUES				(
									#{subject}
									, #{content}
									, #{userNo}
									, NOW()
									, NOW()
									, 0
								) 
	</insert>
	
</mapper>


